# 服药提醒闹钟功能使用指南

## 功能概述

全新的服药提醒闹钟功能可以在设定的时间自动弹出提醒通知,帮助老年人按时服药,再也不用担心忘记吃药!

## 核心功能

### 🔔 自动定时提醒
- 根据药物时间表自动设置闹钟
- 到时间自动弹出醒目的提醒窗口
- 支持浏览器原生通知(需授权)
- 24小时循环提醒

### 📋 服药表查看
- 点击按钮查看完整服药时间表
- 按时间排序,一目了然
- 显示药物名称、时间、剂量、备注

### ✓ 确认服药功能
- "✓ Taken" 按钮确认已服药,关闭提醒
- "⏰ Snooze 10 min" 延迟10分钟再提醒

## 使用步骤

### 第一步: 添加药物时间表

1. 点击 **"👤 My Profile"**
2. 向下滚动到 **"💊 Medication Schedule"**
3. 点击 **"➕ Add Medication"** 添加药物
4. **重要**: 必须填写 **Time** 字段(服药时间)
5. 点击 **"💾 Save Profile"** 保存

**示例**:
| Medication Name | Time | Dosage | Notes |
|----------------|------|---------|-------|
| Metformin | 08:00 | 500mg | After breakfast |
| Aspirin | 21:00 | 81mg | Before bed |

### 第二步: 查看服药提醒列表

1. 点击页面顶部的 **"⏰ Reminders"** 按钮
2. 查看您的所有药物提醒
3. 确认时间设置正确

### 第三步: 启用提醒

1. 在提醒列表窗口底部点击 **"🔔 Enable Reminders"**
2. 如果浏览器弹出通知权限请求,点击 **"允许"**
3. 看到 "✓ Reminders enabled!" 提示
4. 按钮变为 **"🔕 Disable Reminders"**(绿色)

### 第四步: 接收提醒

到达设定时间时:
1. 页面右上角会弹出醒目的提醒窗口
2. 显示药物名称、剂量、备注信息
3. 浏览器可能会发送系统通知

### 第五步: 确认服药

看到提醒后:
- 点击 **"✓ Taken"** - 确认已服药,关闭提醒
- 点击 **"⏰ Snooze 10 min"** - 延迟10分钟后再提醒

## 界面说明

### 提醒按钮位置

```
┌──────────────────────────────────────────┐
│  AICSE                                   │
│  [👤 My Profile] [⏰ Reminders] [🎤...]  │
│                                          │
│         👨‍⚕️              👤              │
│      Doctor           Friend            │
└──────────────────────────────────────────┘
```

### 服药提醒列表界面

```
┌────────────────────────────────────────┐
│  ⏰ Medication Reminders         [×]   │
├────────────────────────────────────────┤
│  Your daily medication schedule...     │
│                                        │
│  ╔══════════════════════════════════╗ │
│  ║ Metformin            [08:00]    ║ │
│  ║ Dosage: 500mg                   ║ │
│  ║ Note: After breakfast           ║ │
│  ╚══════════════════════════════════╝ │
│                                        │
│  ╔══════════════════════════════════╗ │
│  ║ Aspirin              [21:00]    ║ │
│  ║ Dosage: 81mg                    ║ │
│  ║ Note: Before bed                ║ │
│  ╚══════════════════════════════════╝ │
│                                        │
│  ────────────────────────────────────  │
│       [🔔 Enable Reminders]            │
│  Note: Please allow notifications...   │
└────────────────────────────────────────┘
```

### 服药提醒弹窗

```
                    ┌─────────────────────────┐
                    │ 💊 Time to Take Your    │
                    │    Medication!          │
                    ├─────────────────────────┤
                    │                         │
                    │  Metformin              │
                    │  500mg - After breakfast│
                    │  Scheduled time: 08:00  │
                    │                         │
                    │  [✓ Taken] [⏰ Snooze]  │
                    └─────────────────────────┘
```

## 工作原理

### 提醒设置流程

```
点击 "Enable Reminders"
        ↓
读取药物时间表 (localStorage)
        ↓
筛选有时间的药物
        ↓
计算每个药物距离下次服药的时间
        ↓
使用 setTimeout 设置定时器
        ↓
到时间触发提醒
        ↓
显示提醒窗口 + 浏览器通知
        ↓
24小时后自动重新设置提醒
```

### 时间计算逻辑

```javascript
当前时间: 14:30
药物时间: 08:00

情况1: 时间已过 (08:00 < 14:30)
→ 设置为明天 08:00
→ 延迟: 17小时30分钟

情况2: 时间未到 (20:00 > 14:30)
→ 设置为今天 20:00
→ 延迟: 5小时30分钟
```

## 实际使用场景

### 场景 1: 早晨服药

**设置**:
- Metformin | 08:00 | 500mg | After breakfast

**体验**:
```
07:59 - 正常使用应用
08:00 - 弹出提醒窗口,播放提示音
        "💊 Time to Take Your Medication!"
        "Metformin"
        "500mg - After breakfast"
        
用户点击 [✓ Taken] - 提醒关闭

次日 08:00 - 自动再次提醒
```

### 场景 2: 临时有事延迟服药

**情况**: 08:00 提醒弹出,但正在开会

**操作**: 点击 [⏰ Snooze 10 min]

**结果**: 08:10 再次弹出提醒

### 场景 3: 多种药物管理

**设置**:
- 早晨: Metformin (08:00), Lisinopril (08:30)
- 中午: Vitamin D (12:00)
- 晚上: Aspirin (21:00)

**体验**:
```
08:00 - 提醒: Metformin
08:30 - 提醒: Lisinopril
12:00 - 提醒: Vitamin D
21:00 - 提醒: Aspirin
```

## 浏览器通知

### 启用浏览器通知

首次点击 "Enable Reminders" 时:

```
┌─────────────────────────────────────┐
│ 允许 "localhost" 发送通知?          │
│                                     │
│ [阻止]              [允许]          │
└─────────────────────────────────────┘
```

**务必点击 "允许"** 以获得最佳体验!

### 通知内容

```
┌─────────────────────────────┐
│ 💊 Medication Reminder      │
│ ─────────────────────────── │
│ Time to take Metformin      │
│ 500mg                       │
│ After breakfast             │
└─────────────────────────────┘
```

### 通知优势

- ✅ 即使切换到其他标签页也能收到
- ✅ 在桌面显示,更醒目
- ✅ 有系统提示音
- ✅ 可以从通知直接点击回到应用

## 特殊功能

### 自动循环提醒

设置一次,每天自动提醒:
```
今天 08:00 → 提醒
明天 08:00 → 自动再次提醒
后天 08:00 → 自动再次提醒
...
```

### 智能时间处理

- 已过时间 → 自动设置为明天
- 未到时间 → 设置为今天
- 精确到分钟

### 延迟提醒(Snooze)

点击 "Snooze" 后:
- 提醒暂时关闭
- 10分钟后自动再次弹出
- 可以多次延迟

## 最佳实践

### ✅ 推荐做法

1. **设置准确时间**: 在 Profile 中填写准确的服药时间
2. **启用通知**: 允许浏览器通知权限
3. **保持页面打开**: 浏览器标签页不要完全关闭
4. **及时确认**: 看到提醒立即点击 "Taken"
5. **定期检查**: 定期打开 "Reminders" 查看时间表

### ❌ 注意事项

1. **不要关闭标签页**: 关闭后提醒会失效
2. **不要清除浏览器数据**: 会清除药物时间表
3. **不要禁用通知**: 会降低提醒效果
4. **时间必须填写**: 没有时间的药物不会提醒

## 技术细节

### 数据存储

```javascript
// localStorage 中保存的数据
{
  "medicationSchedule": [
    {
      "id": "1697500000000",
      "name": "Metformin",
      "time": "08:00",
      "dosage": "500mg",
      "notes": "After breakfast"
    }
  ]
}
```

### 定时器设置

```javascript
// 计算延迟时间
const delay = getMillisecondsUntil("08:00");

// 设置定时器
setTimeout(() => {
    showMedicationAlert(medication);
    // 24小时后再次提醒
    setMedicationReminder(medication);
}, delay);
```

### 提醒状态

- **未启用**: 按钮显示 "🔔 Enable Reminders"(橙色)
- **已启用**: 按钮显示 "🔕 Disable Reminders"(绿色)

## 常见问题

### Q: 提醒会在哪些情况下失效?

A: 以下情况会导致提醒失效:
- 关闭浏览器标签页
- 电脑关机或休眠
- 浏览器崩溃
- 点击 "Disable Reminders"

解决: 重新打开页面并点击 "Enable Reminders"

### Q: 可以同时提醒多个药物吗?

A: 可以。如果两个药物时间相同,会依次弹出提醒。

### Q: 延迟(Snooze)可以设置不同时间吗?

A: 当前固定为10分钟。未来版本可能支持自定义。

### Q: 提醒音可以更改吗?

A: 当前使用默认提示音。未来版本可能支持自定义铃声。

### Q: 如果错过了提醒怎么办?

A: 点击 "⏰ Reminders" 可以随时查看当天的服药时间表,手动补服(请遵医嘱)。

### Q: 可以记录服药历史吗?

A: 当前版本不支持。点击 "Taken" 只会关闭提醒。未来版本可能添加历史记录功能。

### Q: 手机上可以使用吗?

A: 可以在手机浏览器上使用,但最好保持应用在前台运行。建议使用桌面版以获得最佳体验。

### Q: 提醒会影响其他功能吗?

A: 不会。提醒在后台运行,不影响健康咨询和聊天功能。

## 视觉设计

### 提醒按钮
- 颜色: 橙色渐变 (#ffa726 → #ff9800)
- 图标: ⏰
- 悬停: 向上位移 + 阴影增强

### 服药列表卡片
- 背景: 浅橙色渐变 (#fff9f0 → #fff3e0)
- 边框: 橙色 (#ffcc80)
- 悬停: 向上位移 + 阴影

### 提醒弹窗
- 位置: 屏幕右上角
- 动画: 从右侧滑入
- 脉冲: 阴影闪烁效果
- 图标: 💊 弹跳动画

### 按钮配色
- Taken: 绿色渐变 (#66bb6a → #43a047)
- Snooze: 橙色渐变 (#ffa726 → #ff9800)

## 安全与隐私

- ✅ **本地计算**: 所有提醒逻辑在浏览器本地运行
- ✅ **不联网**: 提醒功能无需网络连接
- ✅ **隐私保护**: 药物信息不上传服务器
- ✅ **用户控制**: 可随时启用/禁用提醒

## 未来功能(计划中)

- 📊 服药历史记录
- 📈 服药统计图表
- 🔊 自定义提醒铃声
- ⏱️ 自定义延迟时间
- 📱 移动端优化
- 🔄 跨设备同步
- 📧 邮件/短信提醒(需后端支持)

## 技术架构

### 前端技术
- **定时器**: JavaScript `setTimeout`
- **通知**: Web Notifications API
- **存储**: localStorage
- **动画**: CSS animations

### 关键函数

```javascript
// 显示提醒列表
displayReminderList()

// 启用/禁用提醒
enableRemindersBtn.onclick

// 设置单个提醒
setMedicationReminder(medication)

// 计算延迟时间
getMillisecondsUntil(timeStr)

// 显示提醒窗口
showMedicationAlert(medication)

// 清除所有提醒
clearAllReminders()
```

## 更新日志

### Version 1.0 (2025-10-17)
- ✅ 添加服药提醒按钮
- ✅ 服药时间表显示
- ✅ 自动定时提醒
- ✅ 浏览器通知集成
- ✅ 已服药确认功能
- ✅ 延迟提醒(Snooze)
- ✅ 24小时循环提醒
- ✅ 提醒启用/禁用切换
- ✅ 视觉动画效果
- ✅ 提示音播放

## 总结

服药提醒闹钟功能让老年人用药管理更加:

- ⏰ **准时**: 精确到分钟的提醒
- 🔔 **醒目**: 多重提醒方式(页面弹窗+浏览器通知+提示音)
- 📋 **清晰**: 一目了然的服药时间表
- ✓ **便捷**: 一键确认已服药
- 🔄 **自动**: 24小时循环,无需每天设置
- 🔒 **安全**: 本地运行,保护隐私

再也不用担心忘记吃药了! 💊⏰✨

## 快速开始

```
1. 点击 "👤 My Profile"
2. 添加药物和服药时间
3. 点击 "💾 Save Profile"
4. 点击 "⏰ Reminders"
5. 点击 "🔔 Enable Reminders"
6. 完成! 等待提醒
```

开始使用服药提醒功能,让 AI 成为您的贴心用药管家! 🌟
